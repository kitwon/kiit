{"componentChunkName":"component---src-templates-post-tsx","path":"/post/pre-commit-hook","webpackCompilationHash":"bf1e1983fb80f780cdbb","result":{"data":{"markdownRemark":{"html":"<p>ä½œä¸ºä¸€ä¸ªç¨‹åºå‘˜ï¼Œæƒ³å¿…æ¯ä¸ªéƒ½æœ‰è‡ªå·±çš„ç¼–ç é£æ ¼ã€‚æœ‰é£æ ¼è™½å¥½ï¼Œä½†è¿™é—®é¢˜ä»¤å¾ˆå¤šé¡¹ç›®ç®¡ç†è€…å¤´ç–¼ï¼Œä¸ä¸€æ ·çš„ä»£ç é£æ ¼åŠç¼©è¿›ï¼Œå¿…ä¼šé™ä½ä»£ç å¯è¯»æ€§ï¼Œä»è€Œé—´æ¥é™ä½æ•ˆç‡ã€‚ä½†æ˜¯è¿™ä¸ªé—®é¢˜éƒ½éš¾ä¸åˆ°æˆ‘ä»¬ä¼Ÿå¤§çš„ç¨‹åºå‘˜ï¼Œå¾ˆå¤šå¦‚eslintï¼Œprettierç­‰åº“çš„å‡ºç°å¸®æˆ‘ä»¬å»è§£å†³é—®é¢˜ã€‚å¾ˆå¤šcliåœ¨ç”Ÿæˆåˆå§‹é¡¹ç›®æ—¶éƒ½ä¼šç»™æˆ‘ä»¬åŠ ä¸Šeslintã€csslintç­‰ï¼Œè¿™ä¸å°±èƒ½è§£å†³æˆ‘ä»¬çš„é—®é¢˜äº†å—ï¼Ÿtoo young too simpleï¼Œæ¯ä¿å­˜ä¸€æ¬¡å°±å¼¹å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè¿˜æ˜¯ä¸€å¤§å †è‹±æ–‡ï¼Œä¼°è®¡å¤§éƒ¨åˆ†äººå¿ƒé‡Œå°±é»˜é»˜ä¸€å¥what the fuck is thatäº†ï¼Œä»è€Œå°±å¯¼è‡´æˆ‘ä»¬å˜´ä¸Šè™½å¾ˆå¼ºç¡¬çš„è¯´ç€è¦è§„èŒƒæˆ‘ä»¬çš„ä»£ç é£æ ¼ï¼Œèº«ä½“å´å¾ˆè¯šå®åœ°é»˜é»˜æŠŠå„ç§lintçš„é…ç½®å…³æ‰ğŸ¤·ğŸ¼â€ã€‚\næ‰€ä»¥åœ¨è¿™ç¯‡æ–‡ç« é‡Œï¼Œä¼šç»™å¤§å®¶æä¾›ä¸€äº›å¥½ç”¨çš„æ–¹æ³•ï¼Œä½¿å„ä½é‡æ‹¾å®šè§„èŒƒæ—¶å€™çš„æ¿€æƒ…ã€‚</p>\n<!-- more -->\n<h2>something useful</h2>\n<ol>\n<li>ä½¿ç”¨<code class=\"language-text\">eslint --fix</code>æ ¼å¼åŒ–æ–‡ä»¶\n<strong>eslint</strong>è™½å¥½ï¼Œä½†æ˜¯å¯¹è§„èŒƒè¿˜æ²¡é€‚åº”çš„åŒå­¦å´æ˜¯ä¸€ä¸ªéš¾é¢˜ï¼Œæ¯å†™ä¸€ééƒ½å¼¹ä¸ªé»‘ç™½å±å‡ºæ¥ï¼Œç‰¹åˆ«è‹±æ–‡ä¸å¥½çš„ï¼Œä¼°è®¡åŠå¤©éƒ½ä¸çŸ¥é“å“ªé‡Œå‡ºé—®é¢˜ï¼Œè¿™æ ·å­ä¸‹æ¥ä¼°è®¡åŠå¤©æ²¡å†™å‡ è¡Œä»£ç ã€‚è¿™æ—¶å€™å…¶å®æˆ‘ä»¬å¯ä»¥è´´å¿ƒåœ°æŠŠé…ç½®é¡¹æ³¨é‡Šæ‰ï¼Œåªæœ‰æäº¤å‰è·‘ä¸€ä¸‹<code class=\"language-text\">eslint --fix</code>è¿™ä¸ªå‘½ä»¤å°±å¥½äº†ï¼Œå¤§éƒ¨åˆ†ä»£ç éƒ½ä¼šæ ¹æ®è§„èŒƒæ ¼å¼åŒ–æ‰ã€‚</li>\n<li>ä½¿ç”¨å„ç§ç¼–è¾‘å™¨ã€IDEæ’ä»¶\nä¸Šæ–¹æ–¹æ³•è™½å¥½ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯è¦ä»æºå¤´ä¸Šè§£å†³é—®é¢˜ï¼ŒåŸ¹å…»æ¯ä¸ªäººçš„ä»£ç é£æ ¼ä»¥åŠä¹ æƒ¯ï¼Œè¿™æ—¶å€™æ’ä»¶å°±èƒ½å¸®ä½æˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™åŠæ—¶å‘ç°ï¼Œä¹Ÿä¸ç”¨çœ‹åˆ°ä¸€å¤§ç‰‡é”™è¯¯äº†ã€‚</li>\n<li>ä½¿ç”¨<strong>prettier</strong>æ ¼å¼åŒ–ä»£ç \nPrettierå¯ä»¥å¸®åŠ©æˆ‘ä»¬åšä¸€äº›ä»£ç æ ¼å¼åŒ–çš„å·¥ä½œï¼Œå¦‚ä»£ç ç¼©è¿›ï¼ŒåŒå¼•å·å˜å•å¼•å·ç­‰ä¸€äº›ä»£ç æ ¼å¼åŒ–å·¥ä½œï¼Œä½†æ˜¯æœ‰äº›é…ç½®é¡¹ä¸eslintæ˜¯é‡å¤çš„ï¼Œä¸‹é¢ä¼šä»‹ç»åˆ°å¦‚ä½•è§£å†³ã€‚å…·ä½“é…ç½®é¡¹å¯ä»¥æŸ¥çœ‹<a href=\"https://prettier.io/docs/en/install.html\">å®˜ç½‘æ–‡æ¡£</a>ã€‚</li>\n</ol>\n<p>è™½ç„¶æœ‰å¾ˆå¤šæ–¹æ³•æé†’æˆ‘ä»¬æ³¨æ„ä»£ç è´¨é‡ï¼Œä½†æ˜¯æœ‰æ—¶å€™è¿™å¹¶ä¸èƒ½é˜»æ­¢æˆ‘ä»¬æŠŠæœ‰linting errorçš„ä»£ç æäº¤åˆ°ä»“åº“ä¸Šã€‚æœ‰æ—¶å€™æ²¡æœ‰ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ˜¯ä½¿ç”¨YUIå‹ç¼©æˆ–è€…å…¶ä»–ä»£ç æ£€æŸ¥å·¥å…·å¯¼è‡´å‘å¸ƒå¤±è´¥ï¼Œæˆ‘ä»¬å°†ä¼šéœ€è¦ç”¨å¤§é‡åœ°æ—¶é—´å»æ‰¾åˆ°nä¸ªäººæäº¤çš„ä»£ç ä¸­çš„1ä¸ªä¸æ˜¾çœ¼çš„è¯­æ³•é”™è¯¯ã€‚</p>\n<h2>Pre-commit hook</h2>\n<p>æ‰€ä»¥ï¼Œä»€ä¹ˆæ˜¯<strong>pre-commit hook</strong>ï¼Ÿå…¶å®Gitç»™æˆ‘é—¨æä¾›äº†å¾ˆå¤šé’©å­ï¼Œæ¯”å¦‚pre-commitè¿™ä¸ªï¼Œå°±æ˜¯æäº¤å‰ï¼Œè¿˜æœ‰æäº¤åï¼Œå…¶ä»–é’©å­å¯è‡ªè¡ŒæŸ¥<a href=\"https://git-scm.com/book/zh/v2/%E8%87%AA%E5%AE%9A%E4%B9%89-Git-Git-%E9%92%A9%E5%AD%90\">Git - Git é’©å­</a>ã€‚(SVNæš‚æ—¶æ— èƒ½ä¸ºåŠ›ï¼Œä¸è¿‡Googleä¸­æœ‰æä¾›è§£å†³æ–¹æ¡ˆï¼Œä½†æ˜¯çœ‹è¿‡ä¸€ä¸‹å®ç°èµ·æ¥é¢‡éº»çƒ¦çš„ï¼Œå¤§å®¶æœ‰å…´è¶£å¯ä»¥è‡ªè¡ŒæŸ¥æ‰¾ä¸€ä¸‹)</p>\n<h3>husky + lint-stage</h3>\n<p>å‡è®¾ä½ çš„é¡¹ç›®ä¸­å·²ç»æœ‰äº†eslintå’Œä½¿ç”¨vueï¼Œç„¶åæˆ‘ä»¬éœ€è¦å®‰è£…ä¸¤ä¸ªpackage</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">npm</span> <span class=\"token function\">install</span> husky lint-stage --save-dev\n\n<span class=\"token comment\"># or use yarn</span>\n$ <span class=\"token function\">yarn</span> <span class=\"token function\">add</span> husky lint-stage -D</code></pre></div>\n<p><strong>1.</strong>    ç„¶ååœ¨<code class=\"language-text\">package.json</code>æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// package.json</span>\n<span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// ...</span>\n  <span class=\"token string\">\"script\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"lint\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"eslint --ext .js,.vue\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"precommit\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"lint-staged\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"lint-staged\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"*.{js|vue}\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"npm run lint\"</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>2.</strong>    ç„¶åéšä¾¿æ‰¾ä¸ªæ–‡ä»¶åˆ æ‰ä¸¤ä¸ªç¼©è¿›ç©ºæ ¼ï¼Œç„¶åè·‘ä¸‹æäº¤å‘½ä»¤<code class=\"language-text\">git commit -am &#39;test precommit&#39;</code>ï¼Œæ­¤æ—¶åº”è¯¥å¯ä»¥çœ‹åˆ°ä¸‹å›¾çš„è¿è¡ŒåŠæŠ¥é”™ã€‚</p>\n<p>âš ï¸ è¿™é‡Œçš„é”™è¯¯å¤§å®¶å¯ä»¥çœ‹åˆ°æ˜¯preiiteræŠ›å‡ºçš„ï¼Œæ˜¯å› ä¸ºæˆ‘çš„é…ç½®æ–‡ä»¶å·²ç»é›†æˆäº†prettierï¼Œå¦‚ä½•é›†æˆä¸‹æ–¹æœ‰ä»‹ç»ã€‚\n<img src=\"https://kiit-1253813979.file.myqcloud.com/pre-commit-hook/lint-error.jpg\" alt=\"pre-commit-error\"></p>\n<p>å¦‚æœæƒ³ä½¿ç”¨eslintè‡ªåŠ¨ä¿®å¤é”™è¯¯ï¼Œå¯ä»¥ä¿®æ”¹æˆå¦‚ä¸‹é…ç½®</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token comment\">// package.json</span>\n<span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// ...</span>\n  <span class=\"token string\">\"script\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"lint\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"eslint --fix --ext .js,.vue\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"precommit\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"lint-staged\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"lint-staged\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"*.{js|vue}\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"npm run lint\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"git add\"</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>è¿™æ ·ä¿®æ­£å¥½çš„æ–‡ä»¶å°±ä¼šé‡æ–°è·‘ä¸€éaddå‘½ä»¤ï¼Œæˆ‘ä»¬åªéœ€é‡æŒ‰ä¸€ä¸‹â¬†ï¸é”®é‡æ–°è·‘ä¸€ä¸‹å‘½ä»¤æäº¤å³å¯ï¼Œperfectã€‚</p>\n<h2>é›†æˆprettierå’ŒJest</h2>\n<p><strong>1.</strong>    prettierè™½ç„¶å’Œeslintæœ‰å¾ˆå¤šå…±åŒé…ç½®ï¼Œä½†æ˜¯prettierè¿˜å¯ä»¥å¯¹<code class=\"language-text\">vue template</code>å’Œæ ·å¼æ–‡ä»¶åšéªŒè¯å’Œæ ¼å¼åŒ–ï¼Œæ›´å¤šé…ç½®æ–¹å¼å¯ä»¥æŸ¥çœ‹<a href=\"https://prettier.io/docs/en/index.html\">æ–‡æ¡£</a>ï¼Œä¸‹é¢åªä»‹ç»å¿«é€Ÿé›†æˆeslintå’Œprettierçš„æ–¹å¼ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£…<code class=\"language-text\">eslint-plugin-prettier</code>å’Œ<code class=\"language-text\">eslint-config-prettier</code></p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> eslint-plugin-prettier eslint-config-prettier --save-dev</code></pre></div>\n<p>ç„¶åä¿®æ”¹æˆ‘ä»¬çš„<code class=\"language-text\">.eslintrc.js</code></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"extends\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"plugin:prettier/recommended\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ç„¶åé‡æ–°æ‰§è¡Œä¸Šæ–¹é…ç½®çš„ç¬¬äºŒéƒ¨å°±å¯ä»¥çœ‹åˆ°ç»“æœäº†ã€‚</p>\n<p><strong>2.</strong>    é›†æˆJeståšunit testã€‚ä¸ºä»€ä¹ˆè¿™é‡Œä¹Ÿä¼šæŠ½å‡ºå•ç‹¬è®²å‘¢ï¼Œç†è®ºä¸Šæˆ‘ä»¬åªéœ€åœ¨é…ç½®ä¸­åŠ æ®µ<code class=\"language-text\">npm run unit</code>å°±è¡Œäº†ï¼Œä½†æ˜¯è¿è¡Œæ—¶å€™ä¼šå‘ç°Jestä¼šæå‡æ²¡æœ‰æ‰¾åˆ°æµ‹è¯•æ–‡ä»¶çš„æƒ…å†µã€‚æ­¤æ—¶æˆ‘ä»¬éœ€è¦ä¿®æ”¹æˆ‘ä»¬çš„npm scriptï¼Œç»™jest cliæ·»åŠ ä¸€ä¸ª<code class=\"language-text\">--findRelatedTests</code>çš„å‚æ•°ã€‚å®˜ç½‘å¯¹è¿™å‚æ•°çš„è§£é‡Šæ˜¯<strong>Useful for pre-commit hook integration to run the minimal amount of tests necessary.</strong> ï¼Œçœ‹èµ·æ¥æ˜¯ä¸ºpre-commitæä¾›çš„ç‰¹æ®Šå‘½ä»¤ï¼Œbut whyğŸ¤·ğŸ¼â€</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token string\">\"script\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"unit\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"jest --config test/jest.conf.js --findRelatedTests\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"lint\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"eslint --fix --ext .js,.vue\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">\"precommit\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"lint-staged\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"lint-staged\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"*.{js|vue}\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token string\">\"npm run lint\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"git add\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string\">\"npm run unit\"</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Last</h2>\n<p>å‚ç…§ä¸Šé¢å‡ æ­¥ï¼Œä¾¿å¾ˆå®¹æ˜“çš„å®ç°æäº¤å‰éªŒè¯ï¼Œæƒ³æ•´åˆæ‰“åŒ…ç­‰åŠŸèƒ½ä¹Ÿååˆ†ç®€å•ï¼Œåªéœ€è¦åœ¨<code class=\"language-text\">lint-stage</code>ä¸­æ·»åŠ <code class=\"language-text\">npm run *</code>æˆ–è€…é›†æˆå…¶ä»–å‘½ä»¤ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°lint-stageå¯ä»¥é€šè¿‡<code class=\"language-text\">glob</code>çš„è¯­æ³•åŒºåˆ†æ–‡ä»¶ç±»å‹æ‰§è¡Œå¯¹åº”çš„scriptï¼Œå¤§å®¶å¯ä»¥è‡ªç”±å‘æŒ¥å®ç°ä¸€ä¸‹è‡ªåŠ¨éƒ¨ç½²ã€‚</p>\n<h3>ç›¸å…³æ–‡æ¡£</h3>\n<ul>\n<li><a href=\"https://prettier.io/docs/en/eslint.html\">prettier- Integrating with ESLint</a></li>\n<li><a href=\"https://github.com/typicode/husky/tree/master\">Husky</a></li>\n<li><a href=\"https://www.npmjs.com/package/lint-staged\">lint-stage</a></li>\n<li><a href=\"https://facebook.github.io/jest/docs/en/cli.html#findrelatedtests-spaceseparatedlistofsourcefiles\">Jest Cli Options</a></li>\n</ul>","frontmatter":{"date":"March 29, 2018","path":"/post/pre-commit-hook","title":"ä½¿ç”¨pre-commitå®ç°æäº¤å‰éªŒè¯æˆ–è‡ªåŠ¨éƒ¨ç½²ä»£ç ","category":["å‰ç«¯"]},"headings":[{"depth":2,"value":"something useful"},{"depth":2,"value":"Pre-commit hook"},{"depth":3,"value":"husky + lint-stage"},{"depth":2,"value":"é›†æˆprettierå’ŒJest"},{"depth":2,"value":"Last"},{"depth":3,"value":"ç›¸å…³æ–‡æ¡£"}],"tableOfContents":"<ul>\n<li><a href=\"/post/pre-commit-hook/#something-useful\">something useful</a></li>\n<li>\n<p><a href=\"/post/pre-commit-hook/#pre-commit-hook\">Pre-commit hook</a></p>\n<ul>\n<li><a href=\"/post/pre-commit-hook/#husky--lint-stage\">husky + lint-stage</a></li>\n</ul>\n</li>\n<li><a href=\"/post/pre-commit-hook/#%E9%9B%86%E6%88%90prettier%E5%92%8Cjest\">é›†æˆprettierå’ŒJest</a></li>\n<li>\n<p><a href=\"/post/pre-commit-hook/#last\">Last</a></p>\n<ul>\n<li><a href=\"/post/pre-commit-hook/#%E7%9B%B8%E5%85%B3%E6%96%87%E6%A1%A3\">ç›¸å…³æ–‡æ¡£</a></li>\n</ul>\n</li>\n</ul>"}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/post/pre-commit-hook","next":{"frontmatter":{"title":"10ä¸ªconsoleçš„é«˜çº§ä½¿ç”¨æ–¹æ³•","date":"2018-03-19","category":["å‰ç«¯"],"tags":null,"path":"/post/10tips-for-console"}},"previous":null}}}